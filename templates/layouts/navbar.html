<!-- Navigation Bar from bootstrap
This HTML is setup as a fragment allowing it to be "included" by other HTML files via Jinja2
-->
<style>
    nav.navbar {
        position: relative;
    }
    a.nav-link {
        background-color: rgba(255, 0, 0, 0.0);
        transition: background-color 0.5s;
        color: var(--txt) !important;
        font-family:Courier;
        margin: 0 5px;
        position: relative;
    }

    .nav-border {
        position: absolute;
        left: 0%;
        right: 0;
        border-bottom: 2px solid transparent;
    }
    .nav-link:hover .nav-border {
        animation-name: border-move;
        animation-duration: 0.8s;
        border-bottom: 2px solid #64483f;
    }
    @keyframes border-move {
        0% {
            right: 100%;
            left: 100%;
        }
        100% {
            right: 0%;
            left: 0%;
        }


    }
    nav {
        background-image: linear-gradient(to right, var(--navbarbg), var(--navbarbg) );
    }
    .dropdown {
        margin-right: 5px;
    }
    .dropdown-menu {
        background-color: var(--navbarbg)
    }
    .dropdown-menu a:hover {
        background-color: var(--bg);
        color: var(--txt);
    }
     #first{
        margin-left:5px;
    }
    .search-icon {
        max-width: 30px;
    }
    #search-hover {
        fill: #000
    }
    #search-hover:hover {
        fill: var(--main-color);
        border: 2px solid var(--main-color)
    }
    .form-control {
        border: none;
        outline: none;
    }
    .form-control:focus {
        background-color: var(--secondary-color);
        color: var(--main-color)
    }
    .form-control:focus::placeholder {
        color:var(--tertiary-color)
    }

    .form-group{
        max-width: 30%;
        position: absolute;
        top: 50px;
        right: 10px;
    }
    .container {
        background-color: var(--main-color);
        color: var(--secondary-color);

    }
    .show-white-space {
        white-space: pre-wrap;
    }

</style>

<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <a style="color:var(--txt);" class="navbar-brand" href="/">{{basename}} </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
        <div class="navbar-nav">
            <!-- url_for is a Jinja2 pre-processor that finds route from function name (def) -->

            <ul class="navbar-nav mr-auto">

                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarStarters" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        About Us
                        <div class="nav-border"></div>
                    </a>

                    <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                        <a class="dropdown-item" href="/evan">Evan</a>
                        <a class="dropdown-item" href="/leah">Leah</a>
                        <a class="dropdown-item" href="/vunsh">Vunsh</a>
                        <a class="dropdown-item" href="/sanjay">Sanjay</a>
                        <a class="dropdown-item" href="/simon">Simon</a>
                    </div>
                </li>
            </ul>
            <ul class="navbar-nav mr-auto">

                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarStarters" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Tools
                        <div class="nav-border"></div>
                    </a>

                    <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                        <a class="dropdown-item" href="/final_grade_calc/">Final Grade</a>
                    </div>
                </li>
            </ul>

            <a class="nav-link" href="/flashcards/">Flash Cards <div class="nav-border"></div></a>
            <a class="nav-link" href="/crud">Database <div class="nav-border"></div></a>
            <a class="nav-link" href="/crud/search">Searchbar <div class="nav-border"></div></a>
            <a class="nav-link" href="/notes">AP Notes <div class="nav-border"></div> </a>
        </div>
    </div>


  
    <style>
        nav {
            z-index: 2;
            background-color: #ceb680;
        }
    </style>
<!--     <button onclick="showSearch()">Search</button> -->
    <div onclick="showSearch()"><svg id="search-hover" class="search-icon" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="16" height="16" viewBox="0 0 16 16"><path  d="M15.504 13.616l-3.79-3.223c-0.392-0.353-0.811-0.514-1.149-0.499 0.895-1.048 1.435-2.407 1.435-3.893 0-3.314-2.686-6-6-6s-6 2.686-6 6 2.686 6 6 6c1.486 0 2.845-0.54 3.893-1.435-0.016 0.338 0.146 0.757 0.499 1.149l3.223 3.79c0.552 0.613 1.453 0.665 2.003 0.115s0.498-1.452-0.115-2.003zM6 10c-2.209 0-4-1.791-4-4s1.791-4 4-4 4 1.791 4 4-1.791 4-4 4z"></path></svg></div>
    <div id="form-group" class="form-group" style="display: none">
        <div style="display: flex;" class="search">
            <input type="text" class="form-control" id="term" placeholder="enter search term">
            <label></label> <!-- used for spacer -->
            <button  type="submit" onclick="search_data();"><img class="search-icon" src="/static/assets/search.svg" alt="search"></button>
        </div>
        <div class="container" >
        <div class="row" id="result"></div>
        </div>
    </div>
    <!--Clock thing-->
    <div style="color:var(--txt);" class="btn-group">
        <!-- Clock display -->
        <div class="px-3" style="color:var(--txt);">
            <span id="clock">12/2/2021, 2:45:33 PM</span>
        </div>
    </div>



    <script>

        // Clock Control
        // clockElement global element set for convenience
        let clockElement = document.getElementById('clock');
        // Clock update executes on each interval set by timer
        function clock() {
            let date = new Date();
            clockElement.textContent = date.toLocaleString();
        }
        // Clock refresh timer, a reoccurring event
        setInterval(clock, 1000);
        // End Clock Control

    </script>
    <script>
        function showSearch() {
            if (document.getElementById("form-group").style.display == "none") {
                document.getElementById("form-group").style.display = "block";
                console.log("displayed")
            } else {
                document.getElementById("form-group").style.display = "none";
                console.log("hidden")
            }
        }

        function search_data() {
            // fetch standard requires data set to a name-value pair
            const term = document.getElementById("term");
            const body = {
                term: term.value
            };
            console.log(body)


            // fetch call with header options
            fetch('/crud/search/term/', {
                method: "POST",
                credentials: "include",
                body: JSON.stringify(body),
                cache: "no-cache",
                headers: new Headers({
                    "content-type": "application/json"
                })
            })
                // async then replies with response header
                .then(function (response) {
                    // prepare HTML search result container for new output
                    const resultContainer = document.getElementById("result");
                    // clean up from previous search
                    while (resultContainer.firstChild) {
                        resultContainer.removeChild(resultContainer.firstChild);
                    }
                    // trap error response from Web API
                    if (response.status !== 200) {
                        const errorMsg = 'Database response error: ' + response.status;
                        console.log(errorMsg);
                        const div = document.createElement("div");
                        div.innerHTML = errorMsg;
                        resultContainer.appendChild(div);
                        return;
                    }
                    // response contains valid result
                    response.json().then(function(data) {
                        // loop through JSON and build HTML output
                        for (let i = 0; i < data.length; i++) {
                            const div = document.createElement("div");
                            div.innerHTML = data[i].name + ' ' + data[i].email;
                            resultContainer.appendChild(div);
                        }
                    })
                })
        }
        term.addEventListener("keyup", function(search_data) {
                document.getElementById("term").click();
        })

    </script>

</nav>

